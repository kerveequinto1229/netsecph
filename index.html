<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digital Passport Check-in Guide</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white shadow-lg rounded-xl p-8 w-full max-w-lg">
    <h1 id="station-title" class="text-2xl font-bold mb-4">Netsec Technologies Inc.</h1>

    <!-- Player Form -->
    <div id="station-form" class="space-y-4">
      <label class="block">
        <span class="text-gray-700">Enter your full name indicated in your digital passport:</span>
        <input id="playerName" type="text" class="mt-1 block w-full border rounded-md p-2"/>
      </label>

      <div id="prev-code-section" class="hidden">
        <label class="block">
          <span class="text-gray-700">Enter Breach Code:</span>
          <input id="prevCode" type="text" class="mt-1 block w-full border rounded-md p-2"/>
        </label>
      </div>

      <button onclick="startStation()" class="bg-blue-500 text-white px-4 py-2 rounded-lg">Start</button>
    </div>

    <!-- Question -->
    <div id="question-container" class="hidden mt-6"></div>
  </div>

  <script>
    // Station-specific configuration
    const stationConfig = {
      1: {
        title: "STEP 1: Authenticate Your Identity to Begin the Breach.",
        successMessage: "INITIAL BREACH COMPLETE <br> First Code Cracked"
      },
      2: {
        title: "Station 2: The Puzzle Chamber",
        successMessage: "Well done! Proceed to Station 3."
      },
      3: {
        title: "Station 3: The Hidden Passage",
        successMessage: "Nice work! You may now continue to Station 4."
      },
      4: {
        title: "Final Station: The Treasure",
        successMessage: "Congratulations! You found the treasure ðŸŽ‰"
      }
    };

    // Questions per station (you can customize these)
    const questions = {
      1: [
        {q: "CHAIN & DECRYPT <br><br> What is 2+2?", options: ["3","4","5"], answer: "4"},
        {q: "CHAIN & DECRYPT <br><br>Which is a fruit?", options: ["Carrot","Apple","Potato"], answer: "Apple"},
        {q: "CHAIN & DECRYPT <br><br>What color is the sky?", options: ["Blue","Red","Green"], answer: "Blue"}
      ],
      2: [
        {q: "Capital of France?", options: ["Rome","Paris","Berlin"], answer: "Paris"},
        {q: "Which is a mammal?", options: ["Shark","Whale","Octopus"], answer: "Whale"},
        {q: "What is 10/2?", options: ["3","5","8"], answer: "5"}
      ],
      3: [
        {q: "Largest planet?", options: ["Earth","Mars","Jupiter"], answer: "Jupiter"},
        {q: "Opposite of hot?", options: ["Warm","Cold","Cool"], answer: "Cold"},
        {q: "How many legs does a spider have?", options: ["6","8","10"], answer: "8"}
      ],
      4: [
        {q: "Primary color?", options: ["Pink","Blue","Cyan"], answer: "Blue"},
        {q: "How many days in a week?", options: ["5","7","9"], answer: "7"},
        {q: "What is 3*3?", options: ["6","9","12"], answer: "9"}
      ]
    };

    // Read ?station=N from URL
    const urlParams = new URLSearchParams(window.location.search);
    const stationNumber = parseInt(urlParams.get("station")) || 1;

    // Update station title
    document.getElementById("station-title").innerText = stationConfig[stationNumber].title;

    // Show previous code input if not station 1
    if (stationNumber > 1) {
      document.getElementById("prev-code-section").classList.remove("hidden");
    }

    // Hash generator (for unique codes)
    async function generateHash(input) {
      const msgUint8 = new TextEncoder().encode(input);
      const hashBuffer = await crypto.subtle.digest("SHA-256", msgUint8);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, "0")).join("").slice(0, 6);
    }

    const hashCache = {};

    async function startStation() {
      const name = document.getElementById("playerName").value.trim();
      if (!name) { alert("Please enter your full name"); return; }

      if (stationNumber > 1) {
        const enteredCode = document.getElementById("prevCode").value.trim();
        const expectedCode = "STN" + (stationNumber-1) + "-" + await generateHash(name + (stationNumber-1));
        if (enteredCode !== expectedCode) {
          alert("Invalid breach code!");
          return;
        }
      }

      document.getElementById("station-form").classList.add("hidden");
      showQuestion(name);
    }

    function showQuestion(name) {
      const qList = questions[stationNumber];
      const q = qList[Math.floor(Math.random() * qList.length)];
      const container = document.getElementById("question-container");
      container.classList.remove("hidden");
      container.innerHTML = `
        <h2 class="text-lg font-bold mb-2">${q.q}</h2>
        ${q.options.map(opt => `
          <button class="block w-full text-left border rounded p-2 mb-2 hover:bg-gray-100"
            onclick="checkAnswer('${opt}','${q.answer}','${name}')">${opt}</button>
        `).join("")}
      `;
    }

    async function checkAnswer(selected, correct, name) {
      if (selected === correct) {
        if (!hashCache[name + stationNumber]) {
          hashCache[name + stationNumber] = await generateHash(name + stationNumber);
        }
        showCode(name);
      } else {
        alert("Wrong answer, try again!");
      }
    }

    function showCode(name) {
      const code = "STN" + stationNumber + "-" + hashCache[name + stationNumber];
      const successMsg = stationConfig[stationNumber].successMessage;
      document.getElementById("question-container").innerHTML = `
        <h2 class="text-xl font-bold">${successMsg}</h2>
        <p class="mt-2">Copy the Breach Code to Advance: 
          <span class="font-mono bg-gray-200 p-1">${code}</span>
        </p>
      `;
    }
  </script>
</body>
</html>
