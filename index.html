<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digital Passport Check-in Guide</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white shadow-lg rounded-xl p-8 w-full max-w-lg">
    <h1 id="station-title" class="text-2xl font-bold mb-4">Netsec Technologies Inc.</h1>

    <!-- Player Form -->
    <div id="station-form" class="space-y-4">
      <label class="block">
        <span class="text-gray-700">Enter your full name indicated in your digital passport:</span>
        <input id="playerName" type="text" class="mt-1 block w-full border rounded-md p-2"/>
      </label>

      <div id="prev-code-section" class="hidden">
        <label class="block">
          <span class="text-gray-700">Enter Breach Code:</span>
          <input id="prevCode" type="text" class="mt-1 block w-full border rounded-md p-2"/>
        </label>
      </div>

      <button onclick="startStation()" class="bg-red-900 text-white px-4 py-2 rounded-lg">Start</button>
    </div>

    <!-- Question -->
    <div id="question-container" class="hidden mt-6"></div>
  </div>

  <script>
    // Station-specific configuration
    const stationConfig = {
      1: {
        title: "Breach the Netsec x Eclypsium Portal to Check-in \n \n STEP 1: Authenticate Your Identity to Begin the Breach.",
        successMessage: "INITIAL BREACH COMPLETE <br> First Code Cracked"
      },
      2: {
        title: "Breach the Netsec x Eclypsium Portal to Check-in \n STEP 2: Authenticate Your Identity to Begin the Breach.",
        successMessage: "BREACH CONFIRMED <br> Layer 2 Compromised"
      },
      3: {
        title: "Breach the Netsec x Eclypsium Portal to Check-in \n STEP 3: Authenticate Your Identity to Begin the Breach.",
        successMessage: "CRITICAL BREACH <br> Only 1 Gate Remain"
      },
      4: {
        title: "Breach the Netsec x Eclypsium Portal to Check-in \n FINAL GATE DETECTED \n STEP 4: Verify Credentials to Breach the Last Gate.",
        successMessage: "SYSTEM BREACHED! <br> Head to the Netsec Technologies Inc. x Eclypsium booth to unlock your final code."
      }
    };

    // Questions per station (you can customize these)
    const questions = {
      1: [
        {q: "CHAIN & DECRYPT <br> What is 2+2?", options: ["3","4","5"], answer: "4"},
        {q: "CHAIN & DECRYPT <br> Which is a fruit?", options: ["Carrot","Apple","Potato"], answer: "Apple"},
        {q: "CHAIN & DECRYPT <br> What color is the sky?", options: ["Blue","Red","Green"], answer: "Blue"}
      ],
      2: [
        {q: "CHAIN & DECRYPT <br> Capital of France?", options: ["Rome","Paris","Berlin"], answer: "Paris"},
        {q: "CHAIN & DECRYPT <br> Which is a mammal?", options: ["Shark","Whale","Octopus"], answer: "Whale"},
        {q: "CHAIN & DECRYPT <br> What is 10/2?", options: ["3","5","8"], answer: "5"}
      ],
      3: [
        {q: "CHAIN & DECRYPT <br> Largest planet?", options: ["Earth","Mars","Jupiter"], answer: "Jupiter"},
        {q: "CHAIN & DECRYPT <br> Opposite of hot?", options: ["Warm","Cold","Cool"], answer: "Cold"},
        {q: "CHAIN & DECRYPT <br> How many legs does a spider have?", options: ["6","8","10"], answer: "8"}
      ],
      4: [
        {q: "CHAIN & DECRYPT <br> Primary color?", options: ["Pink","Blue","Cyan"], answer: "Blue"},
        {q: "CHAIN & DECRYPT <br> How many days in a week?", options: ["5","7","9"], answer: "7"},
        {q: "CHAIN & DECRYPT <br> What is 3*3?", options: ["6","9","12"], answer: "9"}
      ]
    };

    // Read ?station=N from URL
    const urlParams = new URLSearchParams(window.location.search);
    const stationNumber = parseInt(urlParams.get("station")) || 1;

    // Update station title
    document.getElementById("station-title").innerText = stationConfig[stationNumber].title;

    // Show previous code input if not station 1
    if (stationNumber > 1) {
      document.getElementById("prev-code-section").classList.remove("hidden");
    }

    // Hash generator (for unique codes)
    async function generateHash(input) {
      const msgUint8 = new TextEncoder().encode(input);
      const hashBuffer = await crypto.subtle.digest("SHA-256", msgUint8);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, "0")).join("").slice(0, 6);
    }

    const hashCache = {};

    async function startStation() {
      const name = document.getElementById("playerName").value.trim();
      if (!name) { alert("Please enter your full name"); return; }

      if (stationNumber > 1) {
        const enteredCode = document.getElementById("prevCode").value.trim();
        const expectedCode = "STN" + (stationNumber-1) + "-" + await generateHash(name + (stationNumber-1));
        if (enteredCode !== expectedCode) {
          alert("Invalid breach code!");
          return;
        }
      }

      document.getElementById("station-form").classList.add("hidden");
      showQuestion(name);
    }

    function showQuestion(name) {
      const qList = questions[stationNumber];
      const q = qList[Math.floor(Math.random() * qList.length)];
      const container = document.getElementById("question-container");
      container.classList.remove("hidden");
      container.innerHTML = `
        <h2 class="text-lg font-bold mb-2">${q.q}</h2>
        ${q.options.map(opt => `
          <button class="block w-full text-left border rounded p-2 mb-2 hover:bg-gray-100"
            onclick="checkAnswer('${opt}','${q.answer}','${name}')">${opt}</button>
        `).join("")}
      `;
    }

    async function checkAnswer(selected, correct, name) {
      if (selected === correct) {
        if (!hashCache[name + stationNumber]) {
          hashCache[name + stationNumber] = await generateHash(name + stationNumber);
        }
        showCode(name);
      } else {
        alert("Wrong answer, try again!");
      }
    }

    function showCode(name) {
  const code = "STN" + stationNumber + "-" + hashCache[name + stationNumber];
  const successMsg = stationConfig[stationNumber].successMessage;

  document.getElementById("question-container").innerHTML = `
    <h2 class="text-xl font-bold">${successMsg}</h2>
    <p class="mt-2 flex items-center">Copy the Breach Code to Advance: 
      <span id="breachCode" class="font-mono bg-gray-200 p-1 rounded mr-2">${code}</span>
      <button onclick="copyToClipboard('breachCode')" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">Copy</button>
    </p>
  `;
}

// New function to handle copying to clipboard
function copyToClipboard(elementId) {
  const element = document.getElementById(elementId);
  if (!element) {
    console.error("Element not found:", elementId);
    return;
  }

  // Create a temporary textarea element to hold the text
  const tempTextArea = document.createElement("textarea");
  tempTextArea.value = element.textContent;
  document.body.appendChild(tempTextArea);

  // Select the text and copy it
  tempTextArea.select();
  document.execCommand("copy");

  // Remove the temporary textarea
  document.body.removeChild(tempTextArea);

  // Optional: Provide visual feedback to the user
  const copyButton = element.nextElementSibling; // Assuming the button is right after the span
  if (copyButton && copyButton.tagName === 'BUTTON') {
    const originalText = copyButton.textContent;
    copyButton.textContent = "Copied!";
    copyButton.disabled = true; // Disable to prevent multiple clicks
    setTimeout(() => {
      copyButton.textContent = originalText;
      copyButton.disabled = false;
    }, 2000); // Revert text and enable after 2 seconds
  }

  alert("Breach Code copied to clipboard!"); // Or use a less intrusive notification
}

  </script>
</body>
</html>
