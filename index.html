<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Netsec x Eclypsium Challenge</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

  <div id="app" class="max-w-xl w-full p-6 bg-gray-800 rounded-lg shadow-lg">
    <h1 class="text-2xl font-bold mb-4">Netsec x Eclypsium Portal</h1>
    <div id="station-title" class="mb-4"></div>
    <div id="question-container"></div>
  </div>

  <script>
    const stationConfig = {
      1: {
        title: `Station 1 <br><span class="step-text">STEP 1: Breach the Perimeter.</span>`,
        successMessage: "ACCESS GRANTED, {name}! <br><br> Proceed deeper into the system."
      },
      2: {
        title: `Station 2 <br><span class="step-text">STEP 2: Crack the Cipher.</span>`,
        successMessage: "CIPHER BROKEN, {name}! <br><br> You’ve unlocked the next layer."
      },
      3: {
        title: `Station 3 <br><span class="step-text">STEP 3: Override the Controls.</span>`,
        successMessage: "OVERRIDE COMPLETE, {name}! <br><br> Prepare for the final gate."
      },
      4: {
        title: `Breach the Netsec x Eclypsium Portal to Check-in <br>
                <span class="step-text">FINAL GATE DETECTED <br> STEP 4: Verify Credentials to Breach the Last Gate.</span>`,
        successMessage: "YOU HAVE BREACHED THE SYSTEM, {name}! <br><br> Head to the Netsec Technologies Inc. x Eclypsium booth to unlock your final code."
      }
    };

    const questions = {
      1: [
        { q: "What’s the default port for HTTPS?", options: ["80", "22", "443", "25"], answer: "443" }
      ],
      2: [
        { q: "Which cipher is stronger?", options: ["DES", "AES", "ROT13", "Caesar"], answer: "AES" }
      ],
      3: [
        { q: "What does MFA stand for?", options: ["Multi-Factor Auth", "Master File Access", "Mainframe App", "Multi Fast Attack"], answer: "Multi-Factor Auth" }
      ],
      4: [
        { q: "Final Check — which layer is hardware security?", options: ["App Layer", "Hardware/Firmware", "Transport Layer", "Data Layer"], answer: "Hardware/Firmware" }
      ]
    };

    let stationNumber = 1;
    const hashCache = {};

    function escapeHTML(str) {
      return str.replace(/[&<>'"]/g, tag => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[tag]));
    }

    function showQuestion(name) {
      // hide only the step-text inside the station title
      const titleEl = document.getElementById("station-title");
      titleEl.querySelectorAll('.step-text').forEach(el => el.style.display = 'none');

      const qList = questions[stationNumber];
      const q = qList[Math.floor(Math.random() * qList.length)];
      const container = document.getElementById("question-container");
      container.classList.remove("hidden");
      container.innerHTML = `
        <h2 class="text-lg font-bold mb-2">${q.q}</h2>
        ${q.options.map(opt => `
          <button class="block w-full text-left border rounded p-2 mb-2 hover:bg-gray-100 hover:text-gray-900"
            onclick="checkAnswer('${opt}','${q.answer}','${name}')">${opt}</button>
        `).join("")}
      `;
    }

    function checkAnswer(selected, correct, name) {
      if (selected === correct) {
        showCode(name);
      } else {
        alert("ACCESS DENIED — Try again.");
      }
    }

    function showCode(name) {
      const template = stationConfig[stationNumber].successMessage || "";
      const safeName = `<span class="font-semibold text-red-900">${escapeHTML(name)}</span>`;
      const successHTML = template.replace('{name}', safeName);

      // render success message
      let content = `<h2 class="text-xl font-bold">${successHTML}</h2>`;

      if (stationNumber < 4) {
        const code = "STN" + stationNumber + "-" + (hashCache[name + stationNumber] || Math.random().toString(36).substring(2,8).toUpperCase());
        hashCache[name + stationNumber] = code.split("-")[1];
        content += `
          <p class="mt-2 flex flex-col">
            <span class="flex items-center">
              Copy the Breach Code to Advance:
              <span id="breachCode" class="font-mono bg-gray-200 p-1 rounded mr-2 ml-2">${code}</span>
              <button id="copyButton" onclick="copyToClipboard('breachCode')" class="copy-button relative text-gray-700 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 5H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-2M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v2M9 17v-5h5"/>
                </svg>
                <span id="copiedFeedback" class="absolute inset-0 flex items-center justify-center text-xs font-bold bg-white text-blue-600 opacity-0 transition-opacity duration-300"></span>
              </button>
            </span>
            <!-- ALERT text for stations 1–3 -->
            <span class="mt-1 text-xs text-red-900 font-mono italic">
              ALERT: Keep this code safe for the next stage
            </span>
          </p>
        `;
      } else {
        // Station 4 (final) – proof of breach text
        content += `
          <span class="mt-1 text-xs text-red-900 font-mono italic block">
            Proof of breach - present this message at the booth to complete check-in
          </span>
        `;
      }

      document.getElementById("question-container").innerHTML = content;
    }

    function copyToClipboard(id) {
      const codeEl = document.getElementById(id);
      navigator.clipboard.writeText(codeEl.innerText).then(() => {
        const feedback = document.getElementById("copiedFeedback");
        feedback.textContent = "COPIED!";
        feedback.classList.remove("opacity-0");
        setTimeout(() => feedback.classList.add("opacity-0"), 1200);
      });
    }

    // init
    const name = prompt("Enter your agent name:");
    document.getElementById("station-title").innerHTML = stationConfig[stationNumber].title;
    showQuestion(name);
  </script>

</body>
</html>
